import{r as t,U as M,j as e,b as U,y as j}from"./index-CX-r_TzI.js";import{M as p}from"./index-DQ8UN3GZ.js";import{a as A}from"./index-t--hEgTQ.js";import{S as v}from"./ScaleLoader-q_6BlMiq.js";const O=()=>e.jsx("div",{className:"loader-container",children:e.jsx(v,{color:"#EE7F43",height:100,radius:15,speedMultiplier:1,width:1})});p.setAppElement("#root");const B=({isOpen:b,onRequestClose:i,user:N,prato:a,eventId:g,barracaId:f,barracaNome:I,chaveBarraca:C})=>{const{loadingUser:k}=t.useContext(M),[s,c]=t.useState(1),[h,R]=t.useState(""),[m,S]=t.useState(""),[n,E]=t.useState(!1),[d,y]=t.useState(!1),[u,l]=t.useState(!1),[x,L]=t.useState(""),H=()=>{s<a.estoque&&s<10&&c(s+1)},w=()=>{s>1&&c(s-1)},q=async o=>{o.preventDefault(),l(!0);const D={usuarioId:N._id,eventoId:g,barracaId:f,cardapioId:a._id,tipo:"compra",valor:a.valor*s,moeda:"BRL",quantidade:s,valorUnidade:a.valor,descricao:a.ingredientes,detalhes:h||null,dataHoraRetirada:m||null,tempoPreparo:a.tempoPreparo,status:"pendente",chaveBarraca:C,foto:a.imagem};try{const r="http://52.14.179.20",F=await A.post(`${r}/transactions`,D,{headers:{Authorization:`Bearer ${U.get("authToken")}`,"Content-Type":"application/json"}});j.success(F.data.message),l(!1),i()}catch(r){console.error("Erro ao enviar pedido:",r),j.error("Erro ao enviar pedido. Tente novamente."),l(!1)}};return k?e.jsx(O,{}):e.jsx(p,{isOpen:b,onRequestClose:i,shouldCloseOnOverlayClick:!0,className:"comprar-modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"close-button",onClick:i,children:"X"}),e.jsx("img",{src:a.imagem,alt:a.nome,className:"prato-imagem2"}),e.jsxs("div",{className:"prato-info",children:[e.jsx("h3",{className:"prato-nome",children:a.nome}),e.jsx("p",{className:"prato-ingredientes",children:a.ingredientes}),e.jsxs("h3",{className:"prato-valor",children:["R$ ",a.valor.toFixed(2)]})]}),e.jsx("div",{className:"checkbox-container",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>E(!n)}),"Incluir Alterações"]})}),n&&e.jsxs("div",{className:"observacoes",children:[e.jsx("label",{htmlFor:"observacoes",children:"Alterações"}),e.jsx("textarea",{id:"observacoes",value:h,onChange:o=>R(o.target.value)})]}),e.jsx("div",{className:"checkbox-container",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:d,onChange:()=>y(!d)}),"Agendar Retirada"]})}),d&&e.jsxs("div",{className:"data-hora-retirada",children:[e.jsx("label",{htmlFor:"dataHoraRetirada",children:"Data e Hora de Retirada"}),e.jsx("input",{type:"datetime-local",id:"dataHoraRetirada",value:m,onChange:o=>S(o.target.value)})]}),e.jsx("hr",{}),e.jsxs("div",{className:"quantidade-container",children:[e.jsx("h2",{className:"quantidade-label",children:"Unidades"}),e.jsx("button",{className:"quantidade-button",onClick:w,disabled:s<=1,children:"-"}),e.jsx("h2",{className:"quantidade",children:s}),e.jsx("button",{className:"quantidade-button",onClick:H,disabled:s>=a.estoque||s>=10,children:"+"})]}),e.jsx("hr",{}),e.jsx("div",{className:"total-container",children:e.jsxs("h2",{className:"total",children:["Total: R$ ",(a.valor*s).toFixed(2)]})}),x&&e.jsx("p",{className:"error-message",children:x}),e.jsx("button",{className:"pedido-button",onClick:q,disabled:u,children:u?e.jsx(v,{color:"#EE7F43",height:20,radius:10,speedMultiplier:1,width:2}):"Realizar Pedido"})]})})};export{B as default};
