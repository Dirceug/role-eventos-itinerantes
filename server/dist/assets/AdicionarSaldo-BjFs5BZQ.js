import{r as s,U as M,j as a,y as $}from"./index-CX-r_TzI.js";import{M as U}from"./index-DQ8UN3GZ.js";import{a as h}from"./index-t--hEgTQ.js";import{J as y}from"./joi-browser.min-DHFZ_MUq.js";import{S as A}from"./ScaleLoader-q_6BlMiq.js";const V="/assets/olhoFechadoLaranja-Bq5JxRJU.png",T="/assets/olhoAbertoLaranja-Ci-jIhHf.png",H=(r,l)=>{const[e,t]=s.useState(null),[p,f]=s.useState(!0);return s.useEffect(()=>{r&&(async()=>{try{const i=await h.get(`http://52.14.179.20/transactions/saldo/${r}`,{headers:{Authorization:`Bearer ${l}`}});t(i.data.saldo)}catch(c){console.error("Erro ao buscar saldo:",c)}f(!1)})()},[r,l]),{saldo:e,loading:p}},E=()=>a.jsx("div",{className:"loader-container",children:a.jsx(A,{color:"#EE7F43",height:100,radius:15,speedMultiplier:1,width:1})});U.setAppElement("#root");const K=({isOpen:r,onRequestClose:l,userId:e,token:t})=>{const{loadingUser:p}=s.useContext(M),{saldo:f,loading:j,setSaldo:c,setLoadingSaldo:i}=H(e,t),[v,w]=s.useState(""),[S,x]=s.useState(!1),[b,N]=s.useState(""),[L,F]=s.useState(""),[g,B]=s.useState(!1);s.useEffect(()=>{if(r&&e){const d=async()=>{i(!0);try{const o="http://52.14.179.20",m=await h.get(`${o}/transactions/saldo/${e}`,{headers:{Authorization:`Bearer ${t}`}});c(m.data.saldo)}catch(o){console.error("Erro ao buscar saldo:",o)}i(!1)},n=async()=>{try{const o="http://52.14.179.20",m=await h.get(`${o}/users/${e}`,{headers:{Authorization:`Bearer ${t}`}});F(m.data.displayName)}catch(o){console.error("Erro ao buscar usuário:",o)}};d(),n()}},[r,e,t,i,c]);const C=y.object({valor:y.number().min(10).max(500).required().messages({"number.base":"Por favor, insira um valor válido.","number.min":"O valor mínimo é R$10,00.","number.max":"O valor máximo é R$500,00."})}),D=d=>{const n=d.target.value.replace(/\D/g,""),o=(Number(n)/100).toFixed(2).replace(".",",");w(o)},R=async d=>{d.preventDefault();const n=parseFloat(v.replace(",",".")),{error:o}=C.validate({valor:n});if(o){N(o.message);return}N(""),x(!0);const m={usuarioId:e,eventoId:null,valor:n,moeda:"BRL",tipo:"adição de saldo",descricao:"Adição de saldo via frontend",status:"pendente"};try{const u="http://52.14.179.20",J=await h.post(`${u}/transactions`,m,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});$.success(J.data.message),x(!1),l()}catch(u){console.error("Erro ao adicionar saldo:",u),$.error("Erro ao adicionar saldo. Tente novamente."),x(!1)}},z=()=>{B(!g)};return p?a.jsx(E,{}):a.jsx(U,{isOpen:r,onRequestClose:l,className:"adicionar-saldo-modal",children:j?a.jsx(E,{}):a.jsxs("div",{className:"modal-content",children:[a.jsx("button",{className:"close-button",onClick:l,children:"X"}),a.jsxs("p",{className:"saldo-info",children:["Olá ",L,", seu saldo atual é de:"]}),a.jsxs("div",{className:"saldo-container",children:[a.jsxs("h1",{className:"saldo-valor",children:["R$ ",g?`${f}`:"***,**"]}),a.jsx("button",{className:"toggle-saldo-button",onClick:z,children:a.jsx("img",{src:g?T:V,alt:"Toggle Saldo"})})]}),a.jsxs("form",{onSubmit:R,className:"form-label",children:[a.jsx("label",{className:"valor-label",htmlFor:"valor",children:"Valor a adicionar:"}),a.jsxs("div",{className:"valor-input-container",children:[a.jsx("span",{className:"valor-prefixo",children:"R$"}),a.jsx("input",{type:"text",id:"valor",className:"valor-input",value:v,onChange:D,placeholder:"00,00"})]}),b&&a.jsx("p",{className:"error-message",children:b}),a.jsx("button",{type:"submit",className:"submit-button",disabled:S,children:S?a.jsx(A,{color:"#EE7F43",height:20,radius:10,speedMultiplier:1,width:2}):"Adicionar saldo"})]})]})})};export{K as default};
